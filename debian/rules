#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/utils.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk

# The library isn't stable, and shouldn't be used on mainstream distributions.
#
# The AccountManager.service is inappropriate on mainstream distributions,
# as per telepathy-spec - clients should activate a particular implementation,
# not the generic name.
#
# mc-account-convert requires GConf which we don't want to depend on here,
# so if we were compiled on a non-minimal system, get rid of it.
common-binary-post-install-arch:: list-missing
list-missing: remove-cruft
remove-cruft:
	rm -rf debian/tmp/usr/include
	rm -f debian/tmp/usr/lib/libmcclient.a
	rm -f debian/tmp/usr/lib/libmcclient.la
	rm -rf debian/tmp/usr/lib/pkgconfig
	rm -f debian/tmp/usr/share/dbus-1/services/org.freedesktop.Telepathy.AccountManager.service
	rm -rf debian/tmp/usr/share/gtk-doc
	rm -f debian/tmp/usr/bin/mc-account-convert
	rm -f debian/tmp/usr/share/man/man1/mc-account-convert.1

DEB_DH_STRIP_ARGS := --dbg-package=telepathy-mission-control-5-dbg

DEB_CONFIGURE_LIBEXECDIR := "\$${prefix}/lib/telepathy"

# link the libraries statically, since they shouldn't be used outside this
# source package
DEB_CONFIGURE_EXTRA_FLAGS := \
	--disable-Werror \
	--disable-gtk-doc \
	--disable-plugins \
	--enable-server \
	--disable-shared \
	--enable-static

# we symlink some of the doc directories together
DEB_INSTALL_DOCS_telepathy-mission-control-5-dbg := --no-act
DEB_INSTALL_CHANGELOGS_telepathy-mission-control-5-dbg := --no-act

include $(CURDIR)/debian/update-patches.mk
